# {{ ansible_managed }}
# Created on: {{ ansible_date_time.date }} {{ ansible_date_time.time }}

[Interface]
Address = {{ wireguard_address }}
ListenPort = {{ wireguard_port }}

PrivateKey = {{ wireguard_privkey }}
PostUp = iptables -A FORWARD -i %i -j ACCEPT; ip6tables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; ip6tables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o {{ raspi_static_interface }} -j MASQUERADE; ip6tables -t nat -A POSTROUTING -o {{ raspi_static_interface }} -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; ip6tables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; ip6tables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o {{ raspi_static_interface }} -j MASQUERADE; ip6tables -t nat -D POSTROUTING -o {{ raspi_static_interface }} -j MASQUERADE

{% for client in wireguard_clients %}
# {{ client.name }}
[Peer]
PublicKey = {{ client.pubkey }}
AllowedIPs = {{ client.allowed_ips }}
{% endfor %}